services:
  # Auth Service
  auth-service:
    build:
      context: ./backend/services/auth-service
      dockerfile: Dockerfile
    container_name: auth-service
    environment:
      PUERTO: ${AUTH_PORT:-3011}
      JWT_SECRETO: ${JWT_SECRETO}
      JWT_SECRET: ${JWT_SECRETO}
      POSTGRES_URL: postgresql://neondb_owner:npg_zRdlv7TGEJu3@ep-red-voice-adzfb730-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require
      DATABASE_URL: postgresql://neondb_owner:npg_zRdlv7TGEJu3@ep-red-voice-adzfb730-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require
      NODE_ENV: ${NODE_ENV:-production}
    ports:
      - "${AUTH_PORT:-3011}:${AUTH_PORT:-3011}"
    networks:
      - estilo-network
    restart: unless-stopped

  # Catalog Service
  catalog-service:
    build:
      context: ./backend/services/catalog-service
      dockerfile: Dockerfile
    container_name: catalog-service
    environment:
      PUERTO: ${CATALOG_PORT:-3002}
      MONGODB_URI: ${MONGODB_CATALOG_URI}
      CLOUDINARY_CLOUD_NAME: ${CLOUDINARY_CLOUD_NAME}
      CLOUDINARY_API_KEY: ${CLOUDINARY_API_KEY}
      CLOUDINARY_API_SECRET: ${CLOUDINARY_API_SECRET}
    ports:
      - "${CATALOG_PORT:-3002}:${CATALOG_PORT:-3002}"
    networks:
      - estilo-network
    restart: unless-stopped

  # Transaction Service
  transaction-service:
    build:
      context: ./backend/services/transaction-service
      dockerfile: Dockerfile
    container_name: transaction-service
    environment:
      PUERTO: ${TRANSACTION_PORT:-3003}
      JWT_SECRETO: ${JWT_SECRETO}
      JWT_SECRET: ${JWT_SECRETO}
      DATABASE_URL: ${POSTGRES_TRANSACTION_URL}
      NODE_ENV: ${NODE_ENV:-production}
    ports:
      - "${TRANSACTION_PORT:-3003}:${TRANSACTION_PORT:-3003}"
    networks:
      - estilo-network
    restart: unless-stopped

  # Social Service
  social-service:
    build:
      context: ./backend/services/social-service
      dockerfile: Dockerfile
    container_name: social-service
    environment:
      PUERTO: 3004
      MONGODB_URI: mongodb+srv://Vercel-Admin-socialservice:fA5shIvwxTGbAt1P@socialservice.78vidp7.mongodb.net/?retryWrites=true&w=majority
    ports:
      - "3004:3004"
    networks:
      - estilo-network
    restart: unless-stopped

  # Marketing Service
  marketing-service:
    build:
      context: ./backend/services/marketing-service
      dockerfile: Dockerfile
    container_name: marketing-service
    environment:
      PUERTO: 3006
      DATABASE_URL: postgresql://neondb_owner:npg_V6NekxIfwP4E@ep-nameless-dust-ae9ihznv-pooler.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require
    ports:
      - "3006:3006"
    networks:
      - estilo-network
    restart: unless-stopped

  # AI Service
  ai-service:
    build:
      context: ./backend/services/ai-service
      dockerfile: Dockerfile
    container_name: ai-service
    environment:
      PUERTO: 3007
      MONGODB_CATALOG_URI: ${MONGODB_CATALOG_URI}
      MONGODB_SOCIAL_URI: ${MONGODB_SOCIAL_URI}
      AI_GATEWAY_API_KEY: ${AI_GATEWAY_API_KEY}
    ports:
      - "3007:3007"
    networks:
      - estilo-network
    restart: unless-stopped

  # Gateway
  gateway:
    build:
      context: ./simple-gateway
      dockerfile: Dockerfile
    container_name: gateway
    environment:
      PUERTO: ${GATEWAY_PORT:-3000}
      NODE_OPTIONS: "--max-http-header-size=16384"
    ports:
      - "${GATEWAY_PORT:-3000}:${GATEWAY_PORT:-3000}"
    depends_on:
      - auth-service
      - catalog-service
      - transaction-service
    networks:
      - estilo-network
    restart: unless-stopped

  # Frontend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: frontend
    environment:
      VITE_API_URL: ${API_BASE_URL:-http://localhost:3000}
    ports:
      - "${FRONTEND_PORT:-3005}:${FRONTEND_PORT:-3005}"
    depends_on:
      - gateway
    networks:
      - estilo-network
    restart: unless-stopped

  # Credit Service
  credit-service:
    build:
      context: ./backend/services/credit-service
      dockerfile: Dockerfile
    container_name: credit-service
    environment:
      PUERTO: ${CREDIT_PORT:-3008}
      DATABASE_URL: postgresql://neondb_owner:npg_IykA6tTPxhE3@ep-tiny-butterfly-adf8yext-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require
    ports:
      - "${CREDIT_PORT:-3008}:${CREDIT_PORT:-3008}"
    networks:
      - estilo-network
    restart: unless-stopped

  # Logistics Service
  logistics-service:
    build:
      context: ./backend/services/logistics-service
      dockerfile: Dockerfile
    container_name: logistics-service
    environment:
      PUERTO: ${LOGISTICS_PORT:-3009}
    ports:
      - "${LOGISTICS_PORT:-3009}:${LOGISTICS_PORT:-3009}"
    networks:
      - estilo-network
    restart: unless-stopped

networks:
  estilo-network:
    driver: bridge
